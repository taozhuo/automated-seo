{
  "id": 4232404,
  "title": "Need help with profile store",
  "slug": "need-help-with-profile-store",
  "url": "https://devforum.roblox.com/t/need-help-with-profile-store/4232404",
  "category_id": 55,
  "category_name": "Scripting Support",
  "created_at": "2026-01-08T19:51:32.324Z",
  "last_posted_at": "2026-01-08T19:51:32.500Z",
  "views": 17,
  "reply_count": 0,
  "like_count": 0,
  "tags": [],
  "posts": [
    {
      "id": 13662319,
      "username": "RocketSlither",
      "content_raw": "",
      "content_html": "<p>I have been having issues with rollbacks happening when they don’t need to. I am quite new to profile store, and any help would be appreciated.</p>\n<p>Complants: (FC is a currency)<br>\n1:<br>\n<em>I had 483 FC, but when I died and created another match, I had 412 (the number I started the last match)<br>\nI don’t know if this is normal or a bug.</em><br>\n2:<br>\n<em>i had 300 faz coins and rejoined and it converted to 63 coins i think it bought my classes again</em></p>\n<details>\n<summary>\nLobby code</summary>\n<p>lobby loading code:</p>\n<pre data-code-wrap=\"lua\"><code class=\"lang-lua\">local playerFolder = storeFolder:FindFirstChild(Player.Name)\n\tlocal newData = Profile.Data\n\tif not playerFolder then\n\t\tlocal folder = defaultFolder:Clone(); folder.Name = Player.Name; folder.Parent = storeFolder\n\t\tplayerFolder = folder\n\tend\n\n\tlocal bestNight = BestNightService:GetAsync(Player.UserId) or 0\n\tlocal TopDonated = TopDonatedService:GetAsync(Player.UserId) or 0\n\n\tlocal FazCoins = Instance.new(\"NumberValue\")\n\tFazCoins.Name = \"FazCoins\"\n\tFazCoins.Parent = playerFolder\n\tFazCoins.Value = newData.FazCoins or 0\n\n\tlocal EquippedClass = Instance.new(\"StringValue\")\n\tEquippedClass.Name = \"EquippedClass\"\n\tEquippedClass.Parent = playerFolder\n\tEquippedClass.Value = newData.EquippedClass or \"None\"\n\n\tPlayer:SetAttribute(\"EquippedClass\", newData.EquippedClass or \"None\")\n\tPlayer:SetAttribute(\"FazCoins\",  newData.FazCoins or 0)\n\tPlayer:SetAttribute(\"BestNight\", bestNight)\n\tPlayer:SetAttribute(\"Donated\", TopDonated)\n\n\tlocal Connections = {}\n\n\tConnections[1] = FazCoins.Changed:Connect(function()\n\t\tPlayer:SetAttribute(\"FazCoins\",  FazCoins.Value)\n\tend)\n\n\tConnections['end'] = Player.AncestryChanged:Connect(function()\n\t\tfor _, Connection in Connections do\n\t\t\tConnection:Disconnect()\n\t\tend\n\tend)\n\t\n\tConnections[3] = Player.CharacterAdded:Connect(function(Character)\n\n\t\t-- // Give player their over head labels // --\n\t\tHandleNametags(Player, Profile)\n\tend)\n\t\n\tif Player.Character then\n\t\tHandleNametags(Player, Profile)\n\tend\n\n\tlocal OwnedClasses = Instance.new(\"Folder\")\n\tOwnedClasses.Name = \"OwnedClasses\"\n\tOwnedClasses.Parent = playerFolder\n\n\tlocal OwnedClassesList = newData.OwnedClasses or {}\n\tfor _, Class in OwnedClassesList do\n\t\tlocal ClassValue = Instance.new(\"StringValue\")\n\t\tClassValue.Name = Class\n\t\tClassValue.Parent = OwnedClasses\n\tend\n\n\tif #OwnedClassesList &gt;= 1 then\n\t\tif not BadgeService:UserHasBadgeAsync(Player.UserId, 3784697066131220) then\n\t\t\tBadgeService:AwardBadgeAsync(Player.UserId, 3784697066131220)\n\t\tend\n\tend\n\t\n\tif #OwnedClassesList &gt;= 10 then\n\t\tif not BadgeService:UserHasBadgeAsync(Player.UserId, 3782647163983712) then\n\t\t\tBadgeService:AwardBadgeAsync(Player.UserId, 3782647163983712)\n\t\tend\n\tend\n\n\treturn playerFolder\n</code></pre>\n<p>all values in the lobby change the folder<br>\nLobby saving code:</p>\n<pre data-code-wrap=\"lua\"><code class=\"lang-lua\">local PlayerFolder = storeFolder:FindFirstChild(Player.Name)\n\t\t\n\t\tif PlayerFolder == nil then\n\t\t\tprofile:EndSession()\n\t\t\treturn\n\t\tend\n\t\t\n\t\tlocal FazCoins = if PlayerFolder:FindFirstChild(\"FazCoins\") then PlayerFolder.FazCoins.Value else 0\n\t\tlocal EquippedClass = if Player:GetAttribute(\"EquippedClass\") then Player:GetAttribute(\"EquippedClass\") else \"None\"\n\t\tlocal OwnedClasses = if PlayerFolder:FindFirstChild(\"OwnedClasses\") then PlayerFolder.OwnedClasses:GetChildren() else {}\n\t\t\n\t\tlocal NewTable = {}\n\t\t\n\t\t-- clear duplicates\n\t\tfor _, Class in profile.Data.OwnedClasses do\n\t\t\tif table.find(NewTable, Class) == nil then\n\t\t\t\ttable.insert(NewTable, Class)\n\t\t\tend\n\t\tend\n\t\t\n\t\tfor _, Class in OwnedClasses do\n\t\t\tif table.find(NewTable, Class.Name) == nil then\n\t\t\t\ttable.insert(NewTable, Class.Name)\n\t\t\tend\n\t\tend\n\t\t\n\t\tprofile.Data.OwnedClasses = NewTable\t\n\t\tprofile.Data.FazCoins = FazCoins\n\t\tprofile.Data.EquippedClass = EquippedClass\n\t\t\n\t\tprofile:EndSession()\n\t\t\n\t\tTopDonatedService:UpdateAsync(Player.UserId, function(oldValue)\n\t\t\tlocal newBest = Player:GetAttribute(\"Donated\")\n\n\t\t\toldValue = oldValue or 0\n\n\t\t\tif newBest &gt; oldValue then\n\t\t\t\treturn newBest\n\t\t\tend\n\n\t\t\treturn nil\n\t\tend)\n</code></pre>\n</details>\n<details>\n<summary>\nIn game code</summary>\n<p>Loading:</p>\n<pre data-code-wrap=\"lua\"><code class=\"lang-lua\">local profile = PlayerStore:StartSessionAsync(\"Player_\" .. Player.UserId, {\n\t\tCancel = function()\n\t\t\treturn Player.Parent ~= Players\n\t\tend,\n\t})\n\n\tif profile ~= nil then\n\n\t\tprofile:AddUserId(Player.UserId)\n\t\tprofile:Reconcile()\n\n\t\tprofile.OnSessionEnd:Connect(function()\n\t\t\tProfiles[Player] = nil\n\t\t\tPlayer:Kick(`Profile session end - Please rejoin`)\n\t\tend)\n\n\t\tif Player.Parent == Players then\n\t\t\tProfiles[Player] = profile\n\t\t\tprint(`Profile loaded for {Player.DisplayName}!`)\n\t\t\t\n\t\t\ttask.spawn(function()\n\t\t\t\tMigrateData(Player, profile)\n\t\t\tend)\n\t\t\t\n\t\t\tPlayer:SetAttribute(\"FazCoins\", profile.Data.FazCoins)\n\t\t\tPlayer:SetAttribute(\"Class\", profile.Data.EquippedClass)\n\t\t\tPlayer:SetAttribute(\"Cash\", workspace:GetAttribute(\"Game_MoneyEarnedOnSurvival\"))\n\t\t\tPlayer:SetAttribute(\"Shop\", false)\n\t\t\tPlayer:SetAttribute(\"Donated\", TopDonatedService:GetAsync(Player.UserId))\n\t\telse\n\t\t\tprofile:EndSession()\n\t\tend\n\telse\n\t\tPlayer:Kick(`Profile load fail - Please rejoin`)\n\tend\n</code></pre>\n<p>Saving:</p>\n<pre data-code-wrap=\"lua\"><code class=\"lang-lua\">local profile = Profiles[Player]\n\tif profile ~= nil then\n\t\t\n\t\tprofile.Data.FazCoins = Player:GetAttribute(\"FazCoins\")\n\t\t\n\t\tprofile:EndSession()\n\t\t\n\t\tBestNightService:UpdateAsync(Player.UserId, function(oldValue)\n\t\t\tlocal newBest = workspace:GetAttribute(\"DayCount\")\n\n\t\t\toldValue = oldValue or 0\n\n\t\t\tif newBest &gt; oldValue then\n\t\t\t\treturn newBest\n\t\t\tend\n\t\t\t\t\n\t\t\treturn nil\n\t\tend)\n\t\t\n\t\tTopDonatedService:UpdateAsync(Player.UserId, function(oldValue)\n\t\t\tlocal newBest = Player:GetAttribute(\"Donated\")\n\n\t\t\toldValue = oldValue or 0\n\n\t\t\tif newBest &gt; oldValue then\n\t\t\t\treturn newBest\n\t\t\tend\n\n\t\t\treturn nil\n\t\tend)\n\tend\n</code></pre>\n</details>\n<p>Any help is appreciated <img src=\"/images/emoji/twitter/folded_hands.png?v=14\" title=\":folded_hands:\" class=\"emoji\" alt=\":folded_hands:\" loading=\"lazy\" width=\"20\" height=\"20\"><img src=\"/images/emoji/twitter/folded_hands.png?v=14\" title=\":folded_hands:\" class=\"emoji\" alt=\":folded_hands:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "created_at": "2026-01-08T19:51:32.500Z",
      "likes": 0,
      "post_number": 1
    }
  ]
}